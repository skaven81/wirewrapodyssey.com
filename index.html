<!DOCTYPE html>
<!--
vim: ts=2 sts=2 sw=2 expandtab
Uses W3 Schools' Material template: https://www.w3schools.com/w3css/tryit.asp?filename=tryw3css_examples_material
-->
<html>
<head>
  <title>Wire Wrap Odyssey</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <base href="/index.html">
  <link rel="stylesheet" href="/css/w3.css">
  <link rel="stylesheet" href="/css/w3-theme-blue.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <style>
    body {font-family: "Roboto", sans-serif}
    .w3-bar-block .w3-bar-item {
      padding: 16px;
      font-weight: bold;
    }
  </style>
</head>
<body>

<nav class="w3-sidebar w3-bar-block w3-collapse w3-animate-left w3-card" style="z-index:3;width:250px;" id="mySidebar">
  <a class="w3-bar-item w3-button w3-border-bottom w3-large" href="javascript:show_content('overview')">Wire Wrap Odyssey</a>
  <a class="w3-bar-item w3-button w3-hide-large w3-large" href="javascript:void(0)" onclick="w3_close()">Close <i class="fa fa-remove"></i></a>
  <a class="w3-bar-item w3-button" href="javascript:show_content('overview')">Overview</a>
  <a class="w3-bar-item w3-button" href="javascript:show_content('history')">History</a>
  <a class="w3-bar-item w3-button" onclick="accordion('architecture-accordion')" href="javascript:void(0)"><i id="architecture-accordion-caret" class="fa fa-caret-right" style="margin-right:5px;"></i>Architecture</a>
  <div id="architecture-accordion" class="w3-hide accordion">
    <a class="w3-bar-item w3-button w3-small" href="javascript:show_content('arch-overview')">Architecture Overview</a>
    <a class="w3-bar-item w3-button w3-small" href="javascript:show_content('arch-clock-reset')">Clock and Reset Generation</a>
    <a class="w3-bar-item w3-button w3-small" href="javascript:show_content('arch-pc')">Program Counter</a>
    <a class="w3-bar-item w3-button w3-small" href="javascript:show_content('arch-bus')">ROM, RAM & System Bus</a>
    <a class="w3-bar-item w3-button w3-small" href="javascript:show_content('arch-lights')">Blinkenlights</a>
    <a class="w3-bar-item w3-button w3-small" href="javascript:show_content('arch-instruction')">Instruction Decoding</a>
    <a class="w3-bar-item w3-button w3-small" href="javascript:show_content('arch-transfer')">Transfer Registers</a>
    <a class="w3-bar-item w3-button w3-small" href="javascript:show_content('arch-stack')">Stack Pointer</a>
    <a class="w3-bar-item w3-button w3-small" href="javascript:show_content('arch-alu')">Arithmetic Logic Unit</a>
    <a class="w3-bar-item w3-button w3-small" href="javascript:show_content('arch-irq')">Interrupt Handler</a>
  </div>
  <a class="w3-bar-item w3-button" onclick="accordion('peripherals-accordion')" href="javascript:void(0)"><i id="peripherals-accordion-caret" class="fa fa-caret-right" style="margin-right:5px;"></i>Peripherals</a>
  <div id="peripherals-accordion" class="w3-hide accordion">
    <a class="w3-bar-item w3-button w3-small" href="javascript:show_content('periph-overview')">Overview</a>
    <a class="w3-bar-item w3-button w3-small" href="javascript:show_content('periph-kb')">PS/2 Keyboard</a>
    <a class="w3-bar-item w3-button w3-small" href="javascript:show_content('periph-timer')">RTC & Timer</a>
    <a class="w3-bar-item w3-button w3-small" href="javascript:show_content('periph-serial')">RS232 UART</a>
    <a class="w3-bar-item w3-button w3-small" href="javascript:show_content('periph-extram')">1MB Extended RAM</a>
    <a class="w3-bar-item w3-button w3-small" href="javascript:show_content('periph-ata')">ATA Port</a>
  </div>
  <a class="w3-bar-item w3-button" onclick="accordion('video-accordion')" href="javascript:void(0)"><i id="video-accordion-caret" class="fa fa-caret-right" style="margin-right:5px;"></i>Video Card</a>
  <div id="video-accordion" class="w3-hide accordion">
    <a class="w3-bar-item w3-button w3-small" href="javascript:show_content('video-overview')">Overview</a>
    <a class="w3-bar-item w3-button w3-small" href="javascript:show_content('video-hsync-vsync')">Hsync & Vsync Generation</a>
    <a class="w3-bar-item w3-button w3-small" href="javascript:show_content('video-char')">Character Generation</a>
    <a class="w3-bar-item w3-button w3-small" href="javascript:show_content('video-color')">Color Generation</a>
  </div>
  <a class="w3-bar-item w3-button" onclick="accordion('software-accordion')" href="javascript:void(0)"><i id="software-accordion-caret" class="fa fa-caret-right" style="margin-right:5px;"></i>Software</a>
  <div id="software-accordion" class="w3-hide accordion">
    <a class="w3-bar-item w3-button w3-small" href="javascript:show_content('sw-overview')">Overview</a>
    <a class="w3-bar-item w3-button w3-small" href="javascript:show_content('sw-alu')">ALU Generation</a>
    <a class="w3-bar-item w3-button w3-small" href="javascript:show_content('sw-assembler')">Assembler</a>
    <a class="w3-bar-item w3-button w3-small" href="javascript:show_content('sw-library')">OS Library</a>
  </div>
  <a class="w3-bar-item w3-button" href="javascript:show_content('construction')">Construction</a>
  <a class="w3-bar-item w3-button" href="javascript:show_content('photos')">Photos</a>
  <a class="w3-bar-item w3-button" href="javascript:show_content('videos')">Videos</a>
  <a class="w3-bar-item w3-button" href="javascript:show_content('documentation')">Documents &amp; Links</a>
  <a class="w3-bar-item w3-button" href="javascript:show_content('contact')">Contact</a>
</nav>

<div class="w3-overlay w3-hide-large w3-animate-opacity" onclick="w3_close()" style="cursor:pointer" id="myOverlay"></div>

<div class="w3-main" style="margin-left:250px;">

  <div class="w3-container w3-top w3-theme w3-large">
    <p class="top-header">
      <i class="fa fa-bars w3-button w3-blue w3-hide-large w3-xlarge" onclick="w3_open()"></i>
      <span id="section-header" class="w3-strong w3-large"><!-- show_content(id) function inserts title here --></span>
    </p>
  </div>

  <div id="content" class="w3-container" style="padding:64px 32px 16px 32px">
    <!-- show_content(id) function inserts content here -->
  </div>

  <footer class="w3-container w3-theme" style="padding:16px">
    <p><!-- footer goes here --></p>
  </footer>
   
</div>

<script>
// Load the home page document on initial load
document.addEventListener('DOMContentLoaded', function() {
  const state = event.state;
  const initialPageId = window.location.hash.substring(1);
  if (state && state.id) {
    show_content(state.id);
  }
  else if (initialPageId) {
    show_content(initialPageId);
  }
  else {
    show_content('overview');
  }
});

// If the user changes the hash, update accordingly
window.addEventListener('hashchange', function () {
  var newHash = window.location.hash.substring(1);
  show_content(newHash);
});

// Handle forward/back navigation
window.addEventListener('popstate', function (event) {
  const state = event.state;
  if (state && state.id) {
    show_content(state.id);
  }
});

// Open and close the sidebar on medium and small screens
function w3_open() {
  document.getElementById("mySidebar").style.display = "block";
  document.getElementById("myOverlay").style.display = "block";
}

function w3_close() {
  document.getElementById("mySidebar").style.display = "none";
  document.getElementById("myOverlay").style.display = "none";
}

// Show the different sections.  An HTML document by the name of `<id>.html`
// is retrieved from the server.  The element inside with class `section-body`
// is injected into the `content` div above.  The element inside with class
// `section-title` is injected into the `section-header` span above.
function show_content(id) {
  var validIdRegex = /^[a-z-]+$/;
  if (!validIdRegex.test(id) || id.length > 20) {
    console.log("ID " + id + " is invalid");
    return;
  }

  history.pushState({ id: id }, null, `#${id}`);
  fetch("/" + id + ".html")
    .then(response => {
      if(!response.ok) {
        return "<div class='section-body'><pre>" + response.status + ": " + response.statusText + "</pre></div><div class='section-title'>Error</div>";
      }
      else {
        return response.text();
      }
    })
    .then(data => {
      var tempElement = document.createElement('div');
      tempElement.innerHTML = data;
      document.getElementById('content').innerHTML = tempElement.querySelector('.section-body').innerHTML;
      document.getElementById('section-header').innerHTML = tempElement.querySelector('.section-title').innerHTML;
      generateEmailLink();
    })
    .catch(error => {
      console.error("Error in fetch operation:", error);
    })

  // scroll to the top of the page
  window.scrollTo({
    top: 0,
    behavior: 'smooth'
  });
}

// Accordions
function accordion(id) {
  var x = document.getElementById(id);
  var y = document.getElementById(id + "-caret");
  if (x.className.indexOf("w3-show") == -1) {
    x.className += " w3-show";
    y.className = y.className.replace("fa-caret-right", "fa-caret-down");
  } else { 
    x.className = x.className.replace("w3-show", "");
    y.className = y.className.replace("fa-caret-down", "fa-caret-right");
  }
}

function accordion_open(id) {
  var x = document.getElementById(id);
  var y = document.getElementById(id + "-caret");
  if (x.className.indexOf("w3-show") == -1) {
    x.className += " w3-show";
    y.className = y.className.replace("fa-caret-right", "fa-caret-down");
  }
}

function accordion_close(id) {
  var x = document.getElementById(id);
  var y = document.getElementById(id + "-caret");
  if (x.className.indexOf("w3-show") != -1) {
    x.className = x.className.replace("w3-show", "");
    y.className = y.className.replace("fa-caret-down", "fa-caret-right");
  }
}

// Helper to allow linking to a page under an accordion
function accordion_and_show_content(accordion_id, show_id) {
  accordion_open(accordion_id);
  show_content(show_id);
}

function generateEmailLink() {
    var parts = [ "cGF1bAo=", "a3JpemFrCg==", "Z21haWwK", "Y29tCg==", "b2R5c3NleQo=" ];
    var contactParagraph = document.getElementById('contact');
    if (contactParagraph) {
			console.log("found contactParagraph");
			var emailLink = document.createElement('a');
			emailLink.setAttribute('href', 'mailto:' + atob(parts[0]) + "." + atob(parts[1]) + "+" + atob(parts[4]) + "@" + atob(parts[2]) + "." + atob(parts[3]));
			emailLink.innerHTML = 'Contact me via e-mail';
			contactParagraph.innerHTML = '';
			contactParagraph.appendChild(emailLink);
		}
    else {
      console.log("Did not find contactParagraph");
    }
}
</script>
   
</body>
</html> 

